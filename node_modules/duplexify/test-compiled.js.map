{"version":3,"sources":["test.js"],"names":[],"mappings":";;AAAA,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;AAC1B,IAAI,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC,CAAA;AACjC,IAAI,MAAM,GAAG,OAAO,CAAC,eAAe,CAAC,CAAA;AACrC,IAAI,SAAS,GAAG,OAAO,CAAC,IAAI,CAAC,CAAA;;AAE7B,IAAI,CAAC,aAAa,EAAE,UAAS,CAAC,EAAE;AAC9B,GAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;;AAET,MAAI,EAAE,GAAG,OAAO,EAAE,CAAA;AAClB,MAAI,GAAG,GAAG,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAA;;AAE3B,KAAG,CAAC,GAAG,CAAC,aAAa,CAAC,CAAA;AACtB,KAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,YAAW;AAC1B,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,eAAe,CAAC,CAAA;GAC5B,CAAC,CAAA;AACF,KAAG,CAAC,IAAI,CAAC,MAAM,CAAC,UAAS,IAAI,EAAE;AAC7B,KAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,aAAa,EAAE,gBAAgB,CAAC,CAAA;GACzD,CAAC,CAAC,CAAA;CACJ,CAAC,CAAA;;AAEF,IAAI,CAAC,0BAA0B,EAAE,UAAS,CAAC,EAAE;AAC3C,GAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;;AAET,MAAI,EAAE,GAAG,OAAO,EAAE,CAAA;AAClB,MAAI,GAAG,GAAG,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAA;;AAE3B,KAAG,CAAC,GAAG,CAAC,aAAa,CAAC,CAAA;AACtB,KAAG,CAAC,GAAG,EAAE,CAAA;;AAET,KAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,YAAW;AAC1B,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,eAAe,CAAC,CAAA;GAC5B,CAAC,CAAA;AACF,KAAG,CAAC,IAAI,CAAC,MAAM,CAAC,UAAS,IAAI,EAAE;AAC7B,KAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,aAAa,EAAE,gBAAgB,CAAC,CAAA;GACzD,CAAC,CAAC,CAAA;CACJ,CAAC,CAAA;;AAEF,IAAI,CAAC,yBAAyB,EAAE,UAAS,CAAC,EAAE;AAC1C,GAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;;AAET,MAAI,EAAE,GAAG,OAAO,CAAC,GAAG,CAAC,EAAC,aAAa,EAAC,CAAC,EAAC,EAAE,UAAS,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE;AAC9D,cAAU,CAAC,YAAW;AACpB,QAAE,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;KACf,EAAE,GAAG,CAAC,CAAA;GACR,CAAC,CAAA;;AAEF,MAAI,GAAG,GAAG,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAA;;AAE3B,KAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAA;AACnB,KAAG,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;AAClB,KAAG,CAAC,GAAG,EAAE,CAAA;;AAET,KAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,YAAW;AAC1B,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,eAAe,CAAC,CAAA;GAC5B,CAAC,CAAA;AACF,KAAG,CAAC,IAAI,CAAC,MAAM,CAAC,UAAS,IAAI,EAAE;AAC7B,KAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,aAAa,EAAE,gBAAgB,CAAC,CAAA;GACzD,CAAC,CAAC,CAAA;CACJ,CAAC,CAAA;;AAEF,IAAI,CAAC,QAAQ,EAAE,UAAS,CAAC,EAAE;AACzB,MAAI,YAAY,GAAG,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAA;AACjD,MAAI,aAAa,GAAG,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC,CAAA;;AAErD,GAAC,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,GAAC,aAAa,CAAC,MAAM,GAAC,CAAC,CAAC,CAAA;;AAElD,MAAI,QAAQ,GAAG,OAAO,CAAC,GAAG,EAAE,CAAA;AAC5B,MAAI,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,UAAS,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE;AACjD,KAAC,CAAC,IAAI,CAAC,IAAI,EAAE,aAAa,CAAC,KAAK,EAAE,EAAE,sBAAsB,CAAC,CAAA;AAC3D,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;;AAEF,MAAI,GAAG,GAAG,SAAS,CAAC,GAAG,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAA;;AAE3C,cAAY,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,UAAS,IAAI,EAAE;AAC1C,YAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;GACrB,CAAC,CAAA;AACF,UAAQ,CAAC,GAAG,EAAE,CAAA;;AAEd,eAAa,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,UAAS,IAAI,EAAE;AAC3C,OAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;GAChB,CAAC,CAAA;AACF,KAAG,CAAC,GAAG,EAAE,CAAA;;AAET,KAAG,CAAC,EAAE,CAAC,MAAM,EAAE,UAAS,IAAI,EAAE;AAC5B,KAAC,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,CAAC,KAAK,EAAE,EAAE,qBAAqB,CAAC,CAAA;GAC1D,CAAC,CAAA;AACF,KAAG,CAAC,EAAE,CAAC,KAAK,EAAE,YAAW;AACvB,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,YAAY,CAAC,CAAA;GACzB,CAAC,CAAA;AACF,KAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,YAAW;AAC1B,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,eAAe,CAAC,CAAA;GAC5B,CAAC,CAAA;CACH,CAAC,CAAA;;AAEF,IAAI,CAAC,OAAO,EAAE,UAAS,CAAC,EAAE;AACxB,MAAI,GAAG,GAAG,SAAS,EAAE,CAAA;AACrB,MAAI,EAAE,GAAG,OAAO,EAAE,CAAA;;AAElB,KAAG,CAAC,IAAI,CAAC,MAAM,CAAC,UAAS,IAAI,EAAE;AAC7B,KAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,aAAa,EAAE,gBAAgB,CAAC,CAAA;AACxD,KAAC,CAAC,GAAG,EAAE,CAAA;GACR,CAAC,CAAC,CAAA;;AAEH,KAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;AACd,KAAG,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;AAClB,KAAG,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;;AAEhB,YAAU,CAAC,YAAW;AACpB,OAAG,CAAC,WAAW,CAAC,EAAE,CAAC,CAAA;AACnB,cAAU,CAAC,YAAW;AACpB,SAAG,CAAC,WAAW,CAAC,EAAE,CAAC,CAAA;KACpB,EAAE,EAAE,CAAC,CAAA;GACP,EAAE,EAAE,CAAC,CAAA;CACP,CAAC,CAAA;;AAEF,IAAI,CAAC,SAAS,EAAE,UAAS,CAAC,EAAE;AAC1B,GAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;;AAET,MAAI,KAAK,GAAG,OAAO,EAAE,CAAA;AACrB,MAAI,IAAI,GAAG,OAAO,EAAE,CAAA;AACpB,MAAI,GAAG,GAAG,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;;AAEhC,OAAK,CAAC,OAAO,GAAG,YAAW;AACzB,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,iBAAiB,CAAC,CAAA;GAC9B,CAAA;;AAED,KAAG,CAAC,EAAE,CAAC,OAAO,EAAE,YAAW;AACzB,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,eAAe,CAAC,CAAA;GAC5B,CAAC,CAAA;;AAEF,KAAG,CAAC,OAAO,EAAE,CAAA;AACb,KAAG,CAAC,OAAO,EAAE,CAAA;CACd,CAAC,CAAA;;AAEF,IAAI,CAAC,cAAc,EAAE,UAAS,CAAC,EAAE;AAC/B,GAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;;AAET,MAAI,KAAK,GAAG,OAAO,EAAE,CAAA;AACrB,MAAI,IAAI,GAAG,OAAO,EAAE,CAAA;AACpB,MAAI,GAAG,GAAG,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;;AAEhC,OAAK,CAAC,OAAO,GAAG,YAAW;AACzB,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,iBAAiB,CAAC,CAAA;GAC9B,CAAA;;AAED,MAAI,CAAC,OAAO,GAAG,YAAW;AACxB,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAA;GAC7B,CAAA;;AAED,KAAG,CAAC,EAAE,CAAC,OAAO,EAAE,YAAW;AACzB,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,eAAe,CAAC,CAAA;GAC5B,CAAC,CAAA;;AAEF,KAAG,CAAC,OAAO,EAAE,CAAA;AACb,KAAG,CAAC,OAAO,EAAE,CAAA;CACd,CAAC,CAAA;;AAEF,IAAI,CAAC,oBAAoB,EAAE,UAAS,CAAC,EAAE;AACrC,GAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;;AAET,MAAI,KAAK,GAAG,OAAO,EAAE,CAAA;AACrB,MAAI,IAAI,GAAG,OAAO,EAAE,CAAA;AACpB,MAAI,GAAG,GAAG,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;;AAEhC,KAAG,CAAC,EAAE,CAAC,OAAO,EAAE,UAAS,GAAG,EAAE;AAC5B,KAAC,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,YAAY,EAAE,qBAAqB,CAAC,CAAA;GACzD,CAAC,CAAA;AACF,KAAG,CAAC,EAAE,CAAC,OAAO,EAAE,YAAW;AACzB,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,eAAe,CAAC,CAAA;GAC5B,CAAC,CAAA;;AAEF,MAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAA;AAC3C,OAAK,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAA;CAC9C,CAAC,CAAA;;AAEF,IAAI,CAAC,qBAAqB,EAAE,UAAS,CAAC,EAAE;AACtC,GAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;;AAET,MAAI,KAAK,GAAG,OAAO,EAAE,CAAA;AACrB,MAAI,IAAI,GAAG,OAAO,EAAE,CAAA;AACpB,MAAI,GAAG,GAAG,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;;AAEhC,KAAG,CAAC,EAAE,CAAC,OAAO,EAAE,UAAS,GAAG,EAAE;AAC5B,KAAC,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,aAAa,EAAE,sBAAsB,CAAC,CAAA;GAC3D,CAAC,CAAA;AACF,KAAG,CAAC,EAAE,CAAC,OAAO,EAAE,YAAW;AACzB,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,eAAe,CAAC,CAAA;GAC5B,CAAC,CAAA;;AAEF,OAAK,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC,CAAA;AAC7C,MAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAA;CAC5C,CAAC,CAAA;;AAEF,IAAI,CAAC,2BAA2B,EAAE,UAAS,CAAC,EAAE;AAC5C,GAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;;AAET,MAAI,WAAW,GAAG,SAAd,WAAW,CAAY,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE;AACxC,MAAE,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE,CAAC,CAAA;GACxC,CAAA;;AAED,MAAI,WAAW,GAAG,OAAO,EAAE,CAAA;AAC3B,MAAI,KAAK,GAAG,OAAO,CAAC,WAAW,CAAC,CAAA;AAChC,MAAI,GAAG,GAAG,SAAS,CAAC,WAAW,EAAE,WAAW,CAAC,CAAA;;AAE7C,KAAG,CAAC,IAAI,CAAC,MAAM,EAAE,UAAS,IAAI,EAAE;AAC9B,KAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,OAAO,CAAC,CAAA;AAChC,OAAG,CAAC,WAAW,CAAC,KAAK,CAAC,CAAA;AACtB,OAAG,CAAC,WAAW,CAAC,KAAK,CAAC,CAAA;AACtB,OAAG,CAAC,IAAI,CAAC,MAAM,EAAE,UAAS,IAAI,EAAE;AAC9B,OAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,OAAO,CAAC,CAAA;AAChC,SAAG,CAAC,IAAI,CAAC,MAAM,EAAE,UAAS,IAAI,EAAE;AAC9B,SAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,IAAI,CAAC,CAAA;AAC7B,SAAC,CAAC,GAAG,EAAE,CAAA;OACR,CAAC,CAAA;KACH,CAAC,CAAA;AACF,OAAG,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;AAClB,OAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;GAChB,CAAC,CAAA;AACF,KAAG,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;CACnB,CAAC,CAAA;;AAEF,IAAI,CAAC,MAAM,EAAE,UAAS,CAAC,EAAE;AACvB,MAAI,WAAW,GAAG,OAAO,EAAE,CAAA;AAC3B,MAAI,GAAG,GAAG,SAAS,CAAC,WAAW,EAAE,WAAW,CAAC,CAAA;AAC7C,MAAI,EAAE,GAAG,KAAK,CAAA;;AAEd,KAAG,CAAC,EAAE,CAAC,WAAW,EAAE,YAAW;AAC7B,OAAG,CAAC,IAAI,EAAE,CAAA;AACV,cAAU,CAAC,YAAW;AACpB,QAAE,GAAG,IAAI,CAAA;AACT,SAAG,CAAC,MAAM,EAAE,CAAA;KACb,EAAE,GAAG,CAAC,CAAA;GACR,CAAC,CAAA;AACF,KAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,YAAW;AAC1B,KAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAA;AACR,KAAC,CAAC,GAAG,EAAE,CAAA;GACR,CAAC,CAAA;AACF,KAAG,CAAC,GAAG,EAAE,CAAA;CACV,CAAC,CAAA;;AAEF,IAAI,CAAC,qBAAqB,EAAE,UAAS,CAAC,EAAE;AACtC,MAAI,WAAW,GAAG,OAAO,EAAE,CAAA;AAC3B,MAAI,GAAG,GAAG,SAAS,CAAC,WAAW,EAAE,WAAW,CAAC,CAAA;AAC7C,MAAI,WAAW,GAAG,KAAK,CAAA;;AAEvB,KAAG,CAAC,EAAE,CAAC,WAAW,EAAE,YAAW;AAC7B,KAAC,CAAC,EAAE,CAAC,CAAC,WAAW,EAAE,qBAAqB,CAAC,CAAA;AACzC,eAAW,GAAG,IAAI,CAAA;GACnB,CAAC,CAAA;;AAEF,KAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,YAAW;AAC1B,KAAC,CAAC,GAAG,EAAE,CAAA;GACR,CAAC,CAAA;;AAEF,KAAG,CAAC,GAAG,EAAE,CAAA;CACV,CAAC,CAAA;;AAEF,IAAI,CAAC,OAAO,EAAE,UAAS,CAAC,EAAE;AACxB,MAAI,WAAW,GAAG,OAAO,EAAE,CAAA;AAC3B,MAAI,GAAG,GAAG,SAAS,CAAC,WAAW,EAAE,WAAW,CAAC,CAAA;AAC7C,MAAI,EAAE,GAAG,KAAK,CAAA;;AAEd,aAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;AACzB,KAAG,CAAC,EAAE,CAAC,OAAO,EAAE,YAAW;AACzB,KAAC,CAAC,EAAE,CAAC,IAAI,EAAE,sBAAsB,CAAC,CAAA;AAClC,KAAC,CAAC,GAAG,EAAE,CAAA;GACR,CAAC,CAAA;CACH,CAAC,CAAA","file":"test-compiled.js","sourcesContent":["var tape = require('tape')\nvar through = require('through2')\nvar concat = require('concat-stream')\nvar duplexify = require('./')\n\ntape('passthrough', function(t) {\n  t.plan(2)\n\n  var pt = through()\n  var dup = duplexify(pt, pt)\n\n  dup.end('hello world')\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('passthrough + double end', function(t) {\n  t.plan(2)\n\n  var pt = through()\n  var dup = duplexify(pt, pt)\n\n  dup.end('hello world')\n  dup.end()\n\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('async passthrough + end', function(t) {\n  t.plan(2)\n\n  var pt = through.obj({highWaterMark:1}, function(data, enc, cb) {\n    setTimeout(function() {\n      cb(null, data)\n    }, 100)\n  })\n\n  var dup = duplexify(pt, pt)\n\n  dup.write('hello ')\n  dup.write('world')\n  dup.end()\n\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('duplex', function(t) {\n  var readExpected = ['read-a', 'read-b', 'read-c']\n  var writeExpected = ['write-a', 'write-b', 'write-c']\n\n  t.plan(readExpected.length+writeExpected.length+2)\n\n  var readable = through.obj()\n  var writable = through.obj(function(data, enc, cb) {\n    t.same(data, writeExpected.shift(), 'onwrite should match')\n    cb()\n  })\n\n  var dup = duplexify.obj(writable, readable)\n\n  readExpected.slice().forEach(function(data) {\n    readable.write(data)\n  })\n  readable.end()\n\n  writeExpected.slice().forEach(function(data) {\n    dup.write(data)\n  })\n  dup.end()\n\n  dup.on('data', function(data) {\n    t.same(data, readExpected.shift(), 'ondata should match')\n  })\n  dup.on('end', function() {\n    t.ok(true, 'should end')\n  })\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n})\n\ntape('async', function(t) {\n  var dup = duplexify()\n  var pt = through()\n\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'i was async', 'same in as out')\n    t.end()\n  }))\n\n  dup.write('i')\n  dup.write(' was ')\n  dup.end('async')\n\n  setTimeout(function() {\n    dup.setWritable(pt)\n    setTimeout(function() {\n      dup.setReadable(pt)\n    }, 50)\n  }, 50)\n})\n\ntape('destroy', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  write.destroy = function() {\n    t.ok(true, 'write destroyed')\n  }\n\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  dup.destroy()\n  dup.destroy() // should only work once\n})\n\ntape('destroy both', function(t) {\n  t.plan(3)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  write.destroy = function() {\n    t.ok(true, 'write destroyed')\n  }\n\n  read.destroy = function() {\n    t.ok(true, 'read destroyed')\n  }\n\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  dup.destroy()\n  dup.destroy() // should only work once\n})\n\ntape('bubble read errors', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  dup.on('error', function(err) {\n    t.same(err.message, 'read-error', 'received read error')\n  })\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  read.emit('error', new Error('read-error'))\n  write.emit('error', new Error('write-error')) // only emit first error\n})\n\ntape('bubble write errors', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  dup.on('error', function(err) {\n    t.same(err.message, 'write-error', 'received write error')\n  })\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  write.emit('error', new Error('write-error'))\n  read.emit('error', new Error('read-error')) // only emit first error\n})\n\ntape('reset writable / readable', function(t) {\n  t.plan(3)\n\n  var toUpperCase = function(data, enc, cb) {\n    cb(null, data.toString().toUpperCase())\n  }\n\n  var passthrough = through()\n  var upper = through(toUpperCase)\n  var dup = duplexify(passthrough, passthrough)\n\n  dup.once('data', function(data) {\n    t.same(data.toString(), 'hello')\n    dup.setWritable(upper)\n    dup.setReadable(upper)\n    dup.once('data', function(data) {\n      t.same(data.toString(), 'HELLO')\n      dup.once('data', function(data) {\n        t.same(data.toString(), 'HI')\n        t.end()\n      })\n    })\n    dup.write('hello')\n    dup.write('hi')\n  })\n  dup.write('hello')\n})\n\ntape('cork', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var ok = false\n\n  dup.on('prefinish', function() {\n    dup.cork()\n    setTimeout(function() {\n      ok = true\n      dup.uncork()\n    }, 100)\n  })\n  dup.on('finish', function() {\n    t.ok(ok)\n    t.end()\n  })\n  dup.end()\n})\n\ntape('prefinish not twice', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var prefinished = false\n\n  dup.on('prefinish', function() {\n    t.ok(!prefinished, 'only prefinish once')\n    prefinished = true\n  })\n\n  dup.on('finish', function() {\n    t.end()\n  })\n\n  dup.end()\n})\n\ntape('close', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var ok = false\n\n  passthrough.emit('close')\n  dup.on('close', function() {\n    t.ok(true, 'should forward close')\n    t.end()\n  })\n})"]}