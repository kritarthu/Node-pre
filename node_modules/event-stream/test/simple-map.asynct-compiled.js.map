{"version":3,"sources":["simple-map.asynct.js"],"names":[],"mappings":"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","file":"simple-map.asynct-compiled.js","sourcesContent":["'use strict';\n\nvar es = require('../')\n  , it = require('it-is')\n  , u = require('ubelt')\n  , spec = require('stream-spec')\n  , Stream = require('stream')\n  , from = require('from')\n  , through = require('through')\n\n//REFACTOR THIS TEST TO USE es.readArray and es.writeArray\n\nfunction writeArray(array, stream) {\n\n  array.forEach( function (j) {\n    stream.write(j)\n  })\n  stream.end()\n\n}\n\nfunction readStream(stream, done) {\n\n  var array = [] \n  stream.on('data', function (data) {\n    array.push(data)\n  })\n  stream.on('error', done)\n  stream.on('end', function (data) {\n    done(null, array)\n  })\n\n} \n\n//call sink on each write,\n//and complete when finished.\n\nfunction pauseStream (prob, delay) { \n  var pauseIf = (\n      'number' == typeof prob \n    ? function () {\n        return Math.random() < prob\n      } \n    : 'function' == typeof prob \n    ? prob\n    : 0.1\n  )\n  var delayer = ( \n      !delay \n    ? process.nextTick\n    : 'number' == typeof delay \n    ? function (next) { setTimeout(next, delay) }\n    : delay\n  )   \n\n  return es.through(function (data) {    \n    if(!this.paused && pauseIf()) {\n      console.log('PAUSE STREAM PAUSING')\n      this.pause()\n      var self = this\n      delayer(function () {\n        console.log('PAUSE STREAM RESUMING')\n        self.resume()\n      })\n    }\n    console.log(\"emit ('data', \" + data + ')')\n    this.emit('data', data) \n  })\n}\n\nexports ['simple map'] = function (test) {\n\n  var input = u.map(1, 1000, function () {\n    return Math.random() \n  })\n  var expected = input.map(function (v) {\n    return v * 2\n  })\n\n  var pause = pauseStream(0.1)\n  var fs = from(input)\n  var ts = es.writeArray(function (err, ar) {\n    it(ar).deepEqual(expected)\n    test.done()\n  })\n  var map = es.through(function (data) {\n    this.emit('data', data * 2)\n  }) \n\n  spec(map).through().validateOnExit()\n  spec(pause).through().validateOnExit()\n\n  fs.pipe(map).pipe(pause).pipe(ts)\n}\n\nexports ['simple map applied to a stream'] = function (test) {\n\n  var input = [1,2,3,7,5,3,1,9,0,2,4,6]\n  //create event stream from\n\n  var doubler = es.map(function (data, cb) {\n    cb(null, data * 2)\n  })\n\n  spec(doubler).through().validateOnExit()\n\n  //a map is only a middle man, so it is both readable and writable\n  \n  it(doubler).has({\n    readable: true,\n    writable: true,   \n  })\n\n  readStream(doubler, function (err, output) {\n    it(output).deepEqual(input.map(function (j) {\n      return j * 2\n    }))\n//    process.nextTick(x.validate)\n    test.done()\n  })\n  \n  writeArray(input, doubler)\n  \n}\n\nexports['pipe two maps together'] = function (test) {\n\n  var input = [1,2,3,7,5,3,1,9,0,2,4,6]\n  //create event stream from\n  function dd (data, cb) {\n    cb(null, data * 2)\n  }\n  var doubler1 = es.map(dd), doubler2 = es.map(dd)\n\n  doubler1.pipe(doubler2)\n  \n  spec(doubler1).through().validateOnExit()\n  spec(doubler2).through().validateOnExit()\n\n  readStream(doubler2, function (err, output) {\n    it(output).deepEqual(input.map(function (j) {\n      return j * 4\n    }))\n    test.done()\n  })\n  \n  writeArray(input, doubler1)\n\n}\n\n//next:\n//\n// test pause, resume and drian.\n//\n\n// then make a pipe joiner:\n//\n// plumber (evStr1, evStr2, evStr3, evStr4, evStr5)\n//\n// will return a single stream that write goes to the first \n\nexports ['map will not call end until the callback'] = function (test) {\n\n  var ticker = es.map(function (data, cb) {\n    process.nextTick(function () {\n      cb(null, data * 2)\n    })\n  })\n\n  spec(ticker).through().validateOnExit()\n\n  ticker.write('x')\n  ticker.end() \n\n  ticker.on('end', function () {\n    test.done()\n  })\n}\n\n\nexports ['emit error thrown'] = function (test) {\n\n  var err = new Error('INTENSIONAL ERROR')\n    , mapper = \n  es.map(function () {\n    throw err\n  })\n\n  mapper.on('error', function (_err) {\n    it(_err).equal(err)  \n    test.done()\n  })\n\n//  onExit(spec(mapper).basic().validate)\n//need spec that says stream may error.\n\n  mapper.write('hello')\n\n}\n\nexports ['emit error calledback'] = function (test) {\n\n  var err = new Error('INTENSIONAL ERROR')\n    , mapper = \n  es.map(function (data, callback) {\n    callback(err)\n  })\n\n  mapper.on('error', function (_err) {\n    it(_err).equal(err)  \n    test.done()\n  })\n\n  mapper.write('hello')\n\n}\n\nexports ['do not emit drain if not paused'] = function (test) {\n\n  var map = es.map(function (data, callback) {\n    u.delay(callback)(null, 1)\n    return true\n  })\n  \n  spec(map).through().pausable().validateOnExit()\n\n  map.on('drain', function () {\n    it(false).ok('should not emit drain unless the stream is paused')\n  })\n\n  it(map.write('hello')).equal(true)\n  it(map.write('hello')).equal(true)\n  it(map.write('hello')).equal(true)\n  setTimeout(function () {map.end()},10)\n  map.on('end', test.done)\n}\n\nexports ['emits drain if paused, when all '] = function (test) {\n  var active = 0\n  var drained = false\n  var map = es.map(function (data, callback) {\n    active ++\n    u.delay(function () {\n      active --\n      callback(null, 1)\n    })()\n    console.log('WRITE', false)\n    return false\n  })\n\n  spec(map).through().validateOnExit()\n\n  map.on('drain', function () {\n    drained = true\n    it(active).equal(0, 'should emit drain when all maps are done')\n  })\n\n  it(map.write('hello')).equal(false)\n  it(map.write('hello')).equal(false)\n  it(map.write('hello')).equal(false)\n\n  process.nextTick(function () {map.end()},10)\n\n  map.on('end', function () {\n    console.log('end')\n    it(drained).ok('shoud have emitted drain before end')\n    test.done() \n  })\n\n}\n\nexports ['map applied to a stream with filtering'] = function (test) {\n\n  var input = [1,2,3,7,5,3,1,9,0,2,4,6]\n\n  var doubler = es.map(function (data, callback) {\n    if (data % 2)\n      callback(null, data * 2)\n    else\n      callback()\n  })\n  \n  readStream(doubler, function (err, output) {\n    it(output).deepEqual(input.filter(function (j) {\n      return j % 2\n    }).map(function (j) {\n      return j * 2\n    }))\n    test.done()\n  })\n  \n  spec(doubler).through().validateOnExit()\n\n  writeArray(input, doubler)\n  \n}\n\nexports ['simple mapSync applied to a stream'] = function (test) {\n\n  var input = [1,2,3,7,5,3,1,9,0,2,4,6]\n\n  var doubler = es.mapSync(function (data) {\n    return data * 2\n  })\n  \n  readStream(doubler, function (err, output) {\n    it(output).deepEqual(input.map(function (j) {\n      return j * 2\n    }))\n    test.done()\n  })\n  \n  spec(doubler).through().validateOnExit()\n\n  writeArray(input, doubler)\n  \n}\n\nexports ['mapSync applied to a stream with filtering'] = function (test) {\n\n  var input = [1,2,3,7,5,3,1,9,0,2,4,6]\n\n  var doubler = es.mapSync(function (data) {\n    if (data % 2)\n      return data * 2\n  })\n  \n  readStream(doubler, function (err, output) {\n    it(output).deepEqual(input.filter(function (j) {\n      return j % 2\n    }).map(function (j) {\n      return j * 2\n    }))\n    test.done()\n  })\n  \n  spec(doubler).through().validateOnExit()\n\n  writeArray(input, doubler)\n  \n}\n\nrequire('./helper')(module)\n"]}