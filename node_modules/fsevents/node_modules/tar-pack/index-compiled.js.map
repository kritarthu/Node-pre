{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA,YAAY,CAAA;;AAEZ,IAAI,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,UAAU,CAAC,CAAA;AACxC,IAAI,SAAS,GAAG,OAAO,CAAC,YAAY,CAAC,CAAA;AACrC,IAAI,EAAE,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAA;AAC1B,IAAI,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,CAAA;AACxB,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;AAC1B,IAAI,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAA;AAChC,IAAI,MAAM,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAA;;AAEtC,IAAI,WAAW,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,WAAW,IAAI,OAAO,CAAC,iBAAiB,CAAC,CAAC,WAAW,CAAA;AACzF,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;AAC1B,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;;AAE1B,IAAI,KAAK,GAAG,OAAO,CAAC,QAAQ,KAAK,OAAO,CAAA;AACxC,IAAI,KAAK,GAAG,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,EAAE,CAAA;AAC9C,IAAI,KAAK,GAAG,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,EAAE,CAAA;;AAE9C,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,IAAI,KAAK,KAAK,CAAC,EAAE;AACvC,MAAI,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,KAAK,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAA;AAC/D,MAAI,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,KAAK,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAA;CAChE;;AAED,OAAO,CAAC,IAAI,GAAG,IAAI,CAAA;AACnB,OAAO,CAAC,MAAM,GAAG,MAAM,CAAA;;AAEvB,SAAS,IAAI,CAAC,MAAM,EAAE,OAAO,EAAE;AAC7B,SAAO,GAAG,OAAO,IAAI,EAAE,CAAA;AACvB,MAAI,OAAO,MAAM,KAAK,QAAQ,EAAE;;AAE9B,QAAI,OAAM,GAAG,OAAO,CAAC,MAAM,IAAI,UAAU,KAAK,EAAE;AAAE,aAAO,IAAI,CAAC;KAAE,CAAA;;AAEhE,UAAM,GAAG,MAAM,CAAC;AACd,UAAI,EAAE,MAAM;AACZ,UAAI,EAAE,WAAW;AACjB,iBAAW,EAAE,IAAI;AACjB,iBAAW,EAAE,OAAO,CAAC,WAAW,IAAI,CAAC,YAAY,CAAC;AAClD,YAAM,EAAE,gBAAU,KAAK,EAAE;;AACvB,YAAI,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAA;;;;AAI7B,YAAI,QAAQ,KAAK,MAAM,IAAI,QAAQ,KAAK,eAAe,IAAI,QAAQ,CAAC,KAAK,CAAC,sBAAsB,CAAC,IAC7F,QAAQ,KAAK,KAAK,IAAI,QAAQ,KAAK,MAAM,IAAI,QAAQ,KAAK,KAAK,IAAI,QAAQ,CAAC,KAAK,CAAC,aAAa,CAAC,IAChG,QAAQ,KAAK,WAAW,IAAK,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE;AACvD,iBAAO,KAAK,CAAA;SACb;;AAED,eAAO,OAAM,CAAC,KAAK,CAAC,CAAA;OACrB;KACF,CAAC,CAAA;GACH;;;;;;AAMD,MAAI,OAAO,GAAG,GAAG,CAAC,IAAI,CAAC,EAAE,aAAa,EAAE,OAAO,CAAC,aAAa,IAAI,KAAK,EAAE,CAAC,CAAA;AACzE,MAAI,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE,CAAA;;AAEtB,QAAM,CACH,EAAE,CAAC,OAAO,EAAE,UAAU,EAAE,EAAE;AACzB,QAAI,EAAE,EAAE,KAAK,CAAC,sBAAsB,CAAC,CAAA;AACrC,WAAO,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;GAC9B,CAAC,CAAA;AACJ,SAAO,CACJ,EAAE,CAAC,OAAO,EAAE,UAAU,EAAE,EAAE;AACzB,QAAI,EAAE,EAAE,KAAK,CAAC,oBAAoB,CAAC,CAAA;AACnC,QAAI,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;GACvB,CAAC,CAAA;AACJ,SAAO,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;CACvC;;AAED,SAAS,MAAM,CAAC,YAAY,EAAE,OAAO,EAAE,EAAE,EAAE;AACzC,MAAI,OAAO,OAAO,KAAK,UAAU,IAAI,EAAE,KAAK,SAAS,EAAE,EAAE,GAAG,OAAO,EAAE,OAAO,GAAG,SAAS,CAAA;;AAExF,MAAI,OAAO,GAAG,IAAI,WAAW,EAAE,CAAA;AAC/B,MAAI,OAAO,EAAE,KAAK,UAAU,EAAE;AAC5B,MAAE,GAAG,IAAI,CAAC,EAAE,CAAC,CAAA;AACb,WAAO,CAAC,EAAE,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;AACvB,WAAO,CAAC,EAAE,CAAC,OAAO,EAAE,YAAY;AAC9B,QAAE,EAAE,CAAA;KACL,CAAC,CAAA;GACH;;AAED,MAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAA;AACvC,MAAI,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAA;;AAEtC,SAAO,GAAG,OAAO,IAAI,EAAE,CAAA;AACvB,MAAI,GAAG,GAAG,OAAO,CAAC,GAAG,IAAI,IAAI,CAAA;AAC7B,MAAI,GAAG,GAAG,OAAO,CAAC,GAAG,IAAI,IAAI,CAAA;AAC7B,MAAI,KAAK,GAAG,OAAO,CAAC,KAAK,IAAI,MAAM,CAAA;AACnC,MAAI,KAAK,GAAG,OAAO,CAAC,KAAK,IAAI,MAAM,CAAA;AACnC,MAAI,WAAW,GAAG,OAAO,CAAC,WAAW,KAAK,OAAO,CAAC,WAAW,KAAK,KAAK,GAAG,KAAK,GAAG,UAAU,CAAA,AAAC,CAAA;;;;AAI7F,MAAI,OAAO,CAAC,MAAM,IAAI,CAAC,KAAK,EAAE;AAC5B,OAAG,GAAG,KAAK,CAAA;AACX,OAAG,GAAG,KAAK,CAAA;GACZ;;AAED,MAAI,OAAO,GAAG,CAAC,CAAA;AACf,WAAS,CAAC,GAAG,EAAE,GAAG,EAAE,UAAU,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE;AAC1C,QAAI,EAAE,EAAE;AACN,aAAO,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;AACzB,aAAO,OAAO,CAAC,GAAG,EAAE,CAAA;KACrB;AACD,QAAI,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,CAAA;GAC5B,CAAC,CAAA;AACF,IAAE,CAAC,YAAY,EAAE,UAAU,EAAE,EAAE;AAC7B,QAAI,EAAE,EAAE;AACN,aAAO,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;AACzB,aAAO,OAAO,CAAC,GAAG,EAAE,CAAA;KACrB;AACD,QAAI,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,CAAA;GAC5B,CAAC,CAAA;AACF,WAAS,IAAI,GAAG;;;AAGd,eAAW,CAAC,OAAO,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,WAAW,CAAC,CAAA;GACxE;AACD,SAAO,OAAO,CAAA;CACf;;AAGD,SAAS,WAAW,CAAC,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,WAAW,EAAE;AACzE,OAAK,CAAC,UAAU,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;;AAEzD,WAAS,QAAQ,CAAC,KAAK,EAAE;AACvB,SAAK,CAAC,aAAa,EAAE,KAAK,CAAC,IAAI,CAAC,CAAA;;;AAGhC,QAAI,YAAY,GAAG,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAA;AAC9D,SAAK,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,KAAK,WAAW,GAAG,KAAK,GAAG,KAAK,CAAA,AAAC,CAAA;AACtE,SAAK,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAA;AAC7B,QAAI,YAAY,KAAK,KAAK,CAAC,IAAI,EAAE;AAC/B,WAAK,CAAC,kBAAkB,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE,YAAY,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,CAAA;KAClE;;;AAGD,QAAI,CAAC,KAAK,IAAK,OAAO,GAAG,KAAK,QAAQ,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;AACjE,WAAK,CAAC,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG,GAAG,GAAG,CAAA;AACjC,WAAK,CAAC,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG,GAAG,GAAG,CAAA;KAClC;GACF;;AAED,MAAI,WAAW,GAAG,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,CAAA;;AAE/D,MAAI,CAAC,KAAK,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;AAChE,eAAW,CAAC,GAAG,GAAG,GAAG,CAAA;AACrB,eAAW,CAAC,GAAG,GAAG,GAAG,CAAA;GACtB;;AAED,aAAW,CAAC,MAAM,GAAG,YAAY;;AAE/B,QAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,EAAE;AAC/B,WAAK,CAAC,2BAA2B,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAA;AACjG,aAAO,KAAK,CAAA;KACb;AACD,WAAO,IAAI,CAAA;GACZ,CAAA;;AAGD,MAAI,CAAC,OAAO,EAAE,UAAU,GAAG,EAAE,IAAI,EAAE;AACjC,QAAI,GAAG,EAAE,OAAO,OAAO,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,CAAC,CAAA;AAC1C,QAAI,IAAI,GAAG,OAAO,CAAA;AAClB,QAAI,IAAI,KAAK,MAAM,EAAE;AACnB,UAAI,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAA;AAC9B,UAAI,CAAC,EAAE,CAAC,OAAO,EAAE,UAAU,EAAE,EAAE;AAC3B,YAAI,EAAE,EAAE,KAAK,CAAC,aAAa,CAAC,CAAA;AAC5B,eAAO,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;OAC1B,CAAC,CAAA;AACJ,UAAI,GAAG,KAAK,CAAA;KACb;AACD,QAAI,IAAI,KAAK,KAAK,EAAE;AAClB,UAAI,CACD,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAC9B,EAAE,CAAC,OAAO,EAAE,QAAQ,CAAC,CACrB,EAAE,CAAC,OAAO,EAAE,UAAU,EAAE,EAAE;AACzB,YAAI,EAAE,EAAE,KAAK,CAAC,aAAa,CAAC,CAAA;AAC5B,eAAO,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;OAC1B,CAAC,CACD,EAAE,CAAC,OAAO,EAAE,YAAY;AACvB,eAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;OACtB,CAAC,CAAA;AACJ,aAAM;KACP;AACD,QAAI,IAAI,KAAK,YAAY,IAAI,WAAW,EAAE;AACxC,UAAI,MAAM,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,WAAW,CAAC,EAAE,CAAA;;AAExD,UAAI,CAAC,KAAK,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;AAChE,cAAM,CAAC,GAAG,GAAG,GAAG,CAAA;AAChB,cAAM,CAAC,GAAG,GAAG,GAAG,CAAA;OACjB;;AAED,UAAI,CACD,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAC5B,EAAE,CAAC,OAAO,EAAE,UAAU,EAAE,EAAE;AACzB,YAAI,EAAE,EAAE,KAAK,CAAC,YAAY,CAAC,CAAA;AAC3B,eAAO,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;OAC1B,CAAC,CACD,EAAE,CAAC,OAAO,EAAE,YAAY;AACvB,eAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;OACtB,CAAC,CAAA;AACJ,aAAM;KACP;;AAED,WAAO,EAAE,CAAC,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC,CAAC;GACnD,CAAC,CAAA;CACH;;AAED,SAAS,IAAI,CAAC,MAAM,EAAE,QAAQ,EAAE;AAC9B,QAAM,CAAC,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,CAAA;AAC1B,QAAM,CAAC,EAAE,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;AACxB,WAAS,MAAM,CAAC,GAAG,EAAE;AACnB,UAAM,CAAC,cAAc,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;AACpC,UAAM,CAAC,cAAc,CAAC,OAAO,EAAE,MAAM,CAAC,CAAA;GACvC;AACD,WAAS,KAAK,CAAC,KAAK,EAAE;;;;;;AAMpB,QAAI,KAAK,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,KAAK,CAAC,CAAC,CAAC,KAAK,IAAI,IAAI,KAAK,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;AAC/D,cAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA;KACvB,MAAM,IAAI,KAAK,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,kBAAkB,CAAC,EAAE;;AAErD,cAAQ,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;KACtB,MAAM;AACL,cAAQ,CAAC,IAAI,EAAE,YAAY,CAAC,CAAA;KAC7B;;;AAGD,UAAM,CAAC,cAAc,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;AACpC,UAAM,CAAC,cAAc,CAAC,OAAO,EAAE,MAAM,CAAC,CAAA;AACtC,UAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;GACtB;CACF","file":"index-compiled.js","sourcesContent":["\"use strict\"\n\nvar debug = require('debug')('tar-pack')\nvar uidNumber = require('uid-number')\nvar rm = require('rimraf')\nvar tar = require('tar')\nvar once = require('once')\nvar fstream = require('fstream')\nvar packer = require('fstream-ignore')\n\nvar PassThrough = require('stream').PassThrough || require('readable-stream').PassThrough\nvar zlib = require('zlib')\nvar path = require('path')\n\nvar win32 = process.platform === 'win32'\nvar myUid = process.getuid && process.getuid()\nvar myGid = process.getgid && process.getgid()\n\nif (process.env.SUDO_UID && myUid === 0) {\n  if (!isNaN(process.env.SUDO_UID)) myUid = +process.env.SUDO_UID\n  if (!isNaN(process.env.SUDO_GID)) myGid = +process.env.SUDO_GID\n}\n\nexports.pack = pack\nexports.unpack = unpack\n\nfunction pack(folder, options) {\n  options = options || {}\n  if (typeof folder === 'string') {\n\n    var filter = options.filter || function (entry) { return true; }\n\n    folder = packer({\n      path: folder,\n      type: 'Directory',\n      isDirectory: true,\n      ignoreFiles: options.ignoreFiles || ['.gitignore'],\n      filter: function (entry) { // {path, basename, dirname, type} (type is \"Directory\" or \"File\")\n        var basename = entry.basename\n        // some files are *never* allowed under any circumstances\n        // these files should always be either temporary files or\n        // version control related files\n        if (basename === '.git' || basename === '.lock-wscript' || basename.match(/^\\.wafpickle-[0-9]+$/) ||\n            basename === 'CVS' || basename === '.svn' || basename === '.hg' || basename.match(/^\\..*\\.swp$/) ||\n            basename === '.DS_Store' ||  basename.match(/^\\._/)) {\n          return false\n        }\n        //custom excludes\n        return filter(entry)\n      }\n    })\n  }\n  // By default, npm includes some proprietary attributes in the\n  // package tarball.  This is sane, and allowed by the spec.\n  // However, npm *itself* excludes these from its own package,\n  // so that it can be more easily bootstrapped using old and\n  // non-compliant tar implementations.\n  var tarPack = tar.Pack({ noProprietary: options.noProprietary || false })\n  var gzip = zlib.Gzip()\n\n  folder\n    .on('error', function (er) {\n      if (er) debug('Error reading folder')\n      return gzip.emit('error', er)\n    })\n  tarPack\n    .on('error', function (er) {\n      if (er) debug('tar creation error')\n      gzip.emit('error', er)\n    })\n  return folder.pipe(tarPack).pipe(gzip)\n}\n\nfunction unpack(unpackTarget, options, cb) {\n  if (typeof options === 'function' && cb === undefined) cb = options, options = undefined\n\n  var tarball = new PassThrough()\n  if (typeof cb === 'function') {\n    cb = once(cb)\n    tarball.on('error', cb)\n    tarball.on('close', function () {\n      cb()\n    })\n  }\n\n  var parent = path.dirname(unpackTarget)\n  var base = path.basename(unpackTarget)\n\n  options = options || {}\n  var gid = options.gid || null\n  var uid = options.uid || null\n  var dMode = options.dmode || 0x0777 //npm.modes.exec\n  var fMode = options.fmode || 0x0666 //npm.modes.file\n  var defaultName = options.defaultName || (options.defaultName === false ? false : 'index.js')\n\n  // figure out who we're supposed to be, if we're not pretending\n  // to be a specific user.\n  if (options.unsafe && !win32) {\n    uid = myUid\n    gid = myGid\n  }\n\n  var pending = 2\n  uidNumber(uid, gid, function (er, uid, gid) {\n    if (er) {\n      tarball.emit('error', er)\n      return tarball.end()\n    }\n    if (0 === --pending) next()\n  })\n  rm(unpackTarget, function (er) {\n    if (er) {\n      tarball.emit('error', er)\n      return tarball.end()\n    }\n    if (0 === --pending) next()\n  })\n  function next() {\n    // gzip {tarball} --decompress --stdout \\\n    //   | tar -mvxpf - --strip-components=1 -C {unpackTarget}\n    gunzTarPerm(tarball, unpackTarget, dMode, fMode, uid, gid, defaultName)\n  }\n  return tarball\n}\n\n\nfunction gunzTarPerm(tarball, target, dMode, fMode, uid, gid, defaultName) {\n  debug('modes %j', [dMode.toString(8), fMode.toString(8)])\n\n  function fixEntry(entry) {\n    debug('fixEntry %j', entry.path)\n    // never create things that are user-unreadable,\n    // or dirs that are user-un-listable. Only leads to headaches.\n    var originalMode = entry.mode = entry.mode || entry.props.mode\n    entry.mode = entry.mode | (entry.type === 'Directory' ? dMode : fMode)\n    entry.props.mode = entry.mode\n    if (originalMode !== entry.mode) {\n      debug('modified mode %j', [entry.path, originalMode, entry.mode])\n    }\n\n    // if there's a specific owner uid/gid that we want, then set that\n    if (!win32 &&  typeof uid === 'number' && typeof gid === 'number') {\n      entry.props.uid = entry.uid = uid\n      entry.props.gid = entry.gid = gid\n    }\n  }\n\n  var extractOpts = { type: 'Directory', path: target, strip: 1 }\n\n  if (!win32 && typeof uid === 'number' && typeof gid === 'number') {\n    extractOpts.uid = uid\n    extractOpts.gid = gid\n  }\n\n  extractOpts.filter = function () {\n    // symbolic links are not allowed in packages.\n    if (this.type.match(/^.*Link$/)) {\n      debug('excluding symbolic link: ' + this.path.substr(target.length + 1) + ' -> ' + this.linkpath)\n      return false\n    }\n    return true\n  }\n\n\n  type(tarball, function (err, type) {\n    if (err) return tarball.emit('error', err)\n    var strm = tarball\n    if (type === 'gzip') {\n      strm = strm.pipe(zlib.Unzip())\n      strm.on('error', function (er) {\n          if (er) debug('unzip error')\n          tarball.emit('error', er)\n        })\n      type = 'tar'\n    }\n    if (type === 'tar') {\n      strm\n        .pipe(tar.Extract(extractOpts))\n        .on('entry', fixEntry)\n        .on('error', function (er) {\n          if (er) debug('untar error')\n          tarball.emit('error', er)\n        })\n        .on('close', function () {\n          tarball.emit('close')\n        })\n      return\n    }\n    if (type === 'naked-file' && defaultName) {\n      var jsOpts = { path: path.resolve(target, defaultName) }\n\n      if (!win32 && typeof uid === 'number' && typeof gid === 'number') {\n        jsOpts.uid = uid\n        jsOpts.gid = gid\n      }\n\n      strm\n        .pipe(fstream.Writer(jsOpts))\n        .on('error', function (er) {\n          if (er) debug('copy error')\n          tarball.emit('error', er)\n        })\n        .on('close', function () {\n          tarball.emit('close')\n        })\n      return\n    }\n\n    return cb(new Error('Unrecognised package type'));\n  })\n}\n\nfunction type(stream, callback) {\n  stream.on('error', handle)\n  stream.on('data', parse)\n  function handle(err) {\n    stream.removeListener('data', parse)\n    stream.removeListener('error', handle)\n  }\n  function parse(chunk) {\n    // detect what it is.\n    // Then, depending on that, we'll figure out whether it's\n    // a single-file module, gzipped tarball, or naked tarball.\n\n    // gzipped files all start with 1f8b08\n    if (chunk[0] === 0x1F && chunk[1] === 0x8B && chunk[2] === 0x08) {\n      callback(null, 'gzip')\n    } else if (chunk.toString().match(/^package\\/\\u0000/)) {\n      // note, this will only pick up on tarballs with a root directory called package\n      callback(null, 'tar')\n    } else {\n      callback(null, 'naked-file')\n    }\n\n    // now un-hook, and re-emit the chunk\n    stream.removeListener('data', parse)\n    stream.removeListener('error', handle)\n    stream.unshift(chunk)\n  }\n}\n"]}