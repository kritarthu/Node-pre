{"version":3,"sources":["touch.js"],"names":[],"mappings":"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","file":"touch-compiled.js","sourcesContent":["var fs = require(\"fs\")\n  , cons = require(\"constants\")\n\nmodule.exports = touch\ntouch.touchSync = touch.sync = function (f, options) {\n  return touch(f, options)\n}\n\ntouch.ftouch = ftouch\ntouch.ftouchSync = ftouch.sync = function (fd, options) {\n  return ftouch(fd, options)\n}\n\nfunction validOpts (options) {\n  options = Object.create(options || {})\n\n  // {mtime: true}, {ctime: true}\n  // If set to something else, then treat as epoch ms value\n  var now = new Date(options.time || Date.now())\n  if (!options.atime && !options.mtime) {\n    options.atime = options.mtime = now\n  } else {\n    if (true === options.atime) {\n      options.atime = now\n    }\n    if (true === options.mtime) {\n      options.mtime = now\n    }\n  }\n\n  var oflags = 0\n  if (!options.force) {\n    oflags = oflags | cons.O_RDWR\n  }\n\n  if (!options.nocreate) {\n    oflags = oflags | cons.O_CREAT\n  }\n\n  options.oflags = oflags\n  return options\n}\n\nfunction optionsRef (then, arg, options, cb) {\n  if (!options.ref) return then(arg, options, cb)\n\n  return cb\n       ? fs.stat(options.ref, optionsRefcb(then, arg, options, cb))\n       : optionsRefcb(then, arg, options)(null, fs.statSync(options.ref))\n}\n\nfunction optionsRefcb (then, arg, options, cb) { return function (er, s) {\n  if (er) {\n    er.path = er.file = options.ref\n    return cb(er)\n  }\n  options.atime = options.atime && s.atime.getTime()\n  options.mtime = options.mtime && s.mtime.getTime()\n\n  // so we don't keep doing this.\n  options.ref = null\n\n  return then(arg, options, cb)\n}}\n\nfunction touch (f, options, cb) {\n  if (typeof options === \"function\") cb = options, options = null\n  options = validOpts(options)\n  return optionsRef(touch_, f, validOpts(options), cb)\n}\n\nfunction touch_ (f, options, cb) {\n  return openThenF(f, options, cb)\n}\n\nfunction openThenF (f, options, cb) {\n  options.closeAfter = true\n  return cb\n       ? fs.open(f, options.oflags, openThenFcb(options, cb))\n       : openThenFcb(options)(null, fs.openSync(f, options.oflags))\n}\n\nfunction openThenFcb (options, cb) { return function (er, fd) {\n  if (er) {\n    if (fd && options.closeAfter) fs.close(fd, function () {})\n    return cb(er)\n  }\n  return ftouch(fd, options, cb)\n}}\n\nfunction ftouch (fd, options, cb) {\n  if (typeof options === \"function\") cb = options, options = null\n  return optionsRef(ftouch_, fd, validOpts(options), cb)\n}\n\nfunction ftouch_ (fd, options, cb) {\n  // still not set.  leave as what the file already has.\n  return fstatThenFutimes(fd, options, cb)\n}\n\nfunction fstatThenFutimes (fd, options, cb) {\n  if (options.atime && options.mtime) return thenFutimes(fd, options, cb)\n\n  return cb\n       ? fs.fstat(fd, fstatThenFutimescb(fd, options, cb))\n       : fstatThenFutimescb(fd, options)(null, fs.fstatSync(fd))\n}\n\nfunction fstatThenFutimescb (fd, options, cb) { return function (er, s) {\n  if (er) {\n    if (options.closeAfter) fs.close(fd, function () {})\n    return cb(er)\n  }\n  options.atime = options.atime || s.atime.getTime()\n  options.mtime = options.mtime || s.mtime.getTime()\n  return thenFutimes(fd, options, cb)\n}}\n\nfunction thenFutimes (fd, options, cb) {\n  if (typeof options.atime === \"object\") {\n    options.atime = options.atime.getTime()\n  }\n  if (typeof options.mtime === \"object\") {\n    options.mtime = options.mtime.getTime()\n  }\n\n  var a = parseInt(options.atime / 1000, 10)\n    , m = parseInt(options.mtime / 1000, 10)\n  return cb\n       ? fs.futimes(fd, a, m, thenFutimescb(fd, options, cb))\n       : thenFutimescb(fd, options)(null, fs.futimesSync(fd, a, m))\n}\n\nfunction thenFutimescb (fd, options, cb) { return function (er, res) {\n  if (er) {\n    if (options.closeAfter) fs.close(fd, function () {})\n    return cb(er)\n  }\n  return finish(fd, options, res, cb)\n}}\n\nfunction finish (fd, options, res, cb) {\n  return options.closeAfter ? finishClose(fd, options, res, cb)\n       : cb ? cb(null, res)\n       : res\n}\n\nfunction finishClose (fd, options, res, cb) {\n  return cb\n       ? fs.close(fd, finishClosecb(res, options, cb))\n       : finishClosecb(res, options)(null, fs.closeSync(fd))\n}\n\nfunction finishClosecb (res, options, cb) { return function (er) {\n  if (er) return cb(er)\n  options.closeAfter = null\n  return finish(null, options, res, cb)\n}}\n"]}