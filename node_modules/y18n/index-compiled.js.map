{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var fs = require('fs')\nvar path = require('path')\nvar util = require('util')\n\nfunction Y18N (opts) {\n  // configurable options.\n  opts = opts || {}\n  this.directory = opts.directory || './locales'\n  this.updateFiles = typeof opts.updateFiles === 'boolean' ? opts.updateFiles : true\n  this.locale = opts.locale || 'en'\n  this.fallbackToLanguage = typeof opts.fallbackToLanguage === 'boolean' ? opts.fallbackToLanguage : true\n\n  // internal stuff.\n  this.cache = {}\n  this.writeQueue = []\n}\n\nY18N.prototype.__ = function () {\n  var args = Array.prototype.slice.call(arguments)\n  var str = args.shift()\n  var cb = function () {} // start with noop.\n\n  if (typeof args[args.length - 1] === 'function') cb = args.pop()\n  cb = cb || function () {} // noop.\n\n  if (!this.cache[this.locale]) this._readLocaleFile()\n\n  // we've observed a new string, update the language file.\n  if (!this.cache[this.locale][str] && this.updateFiles) {\n    this.cache[this.locale][str] = str\n\n    // include the current directory and locale,\n    // since these values could change before the\n    // write is performed.\n    this._enqueueWrite([this.directory, this.locale, cb])\n  } else {\n    cb()\n  }\n\n  return util.format.apply(util, [this.cache[this.locale][str] || str].concat(args))\n}\n\nY18N.prototype._enqueueWrite = function (work) {\n  this.writeQueue.push(work)\n  if (this.writeQueue.length === 1) this._processWriteQueue()\n}\n\nY18N.prototype._processWriteQueue = function () {\n  var _this = this\n  var work = this.writeQueue[0]\n\n  // destructure the enqueued work.\n  var directory = work[0]\n  var locale = work[1]\n  var cb = work[2]\n\n  var languageFile = this._resolveLocaleFile(directory, locale)\n  var serializedLocale = JSON.stringify(this.cache[locale], null, 2)\n\n  fs.writeFile(languageFile, serializedLocale, 'utf-8', function (err) {\n    _this.writeQueue.shift()\n    if (_this.writeQueue.length > 0) _this._processWriteQueue()\n    cb(err)\n  })\n}\n\nY18N.prototype._readLocaleFile = function () {\n  var localeLookup = {}\n  var languageFile = this._resolveLocaleFile(this.directory, this.locale)\n\n  try {\n    localeLookup = JSON.parse(fs.readFileSync(languageFile, 'utf-8'))\n  } catch (err) {\n    if (err instanceof SyntaxError) {\n      err.message = 'syntax error in ' + languageFile\n    }\n\n    if (err.code === 'ENOENT') localeLookup = {}\n    else throw err\n  }\n\n  this.cache[this.locale] = localeLookup\n}\n\nY18N.prototype._resolveLocaleFile = function (directory, locale) {\n  var file = path.resolve(directory, './', locale + '.json')\n  if (this.fallbackToLanguage && !this._fileExistsSync(file) && ~locale.lastIndexOf('_')) {\n    // attempt fallback to language only\n    var languageFile = path.resolve(directory, './', locale.split('_')[0] + '.json')\n    if (this._fileExistsSync(languageFile)) file = languageFile\n  }\n  return file\n}\n\n// this only exists because fs.existsSync() \"will be deprecated\"\n// see https://nodejs.org/api/fs.html#fs_fs_existssync_path\nY18N.prototype._fileExistsSync = function (file) {\n  try {\n    return fs.statSync(file).isFile()\n  } catch (err) {\n    return false\n  }\n}\n\nY18N.prototype.__n = function () {\n  var args = Array.prototype.slice.call(arguments)\n  var singular = args.shift()\n  var plural = args.shift()\n  var quantity = args.shift()\n\n  var cb = function () {} // start with noop.\n  if (typeof args[args.length - 1] === 'function') cb = args.pop()\n\n  if (!this.cache[this.locale]) this._readLocaleFile()\n\n  var str = quantity === 1 ? singular : plural\n  if (this.cache[this.locale][singular]) {\n    str = this.cache[this.locale][singular][quantity === 1 ? 'one' : 'other']\n  }\n\n  // we've observed a new string, update the language file.\n  if (!this.cache[this.locale][singular] && this.updateFiles) {\n    this.cache[this.locale][singular] = {\n      one: singular,\n      other: plural\n    }\n\n    // include the current directory and locale,\n    // since these values could change before the\n    // write is performed.\n    this._enqueueWrite([this.directory, this.locale, cb])\n  } else {\n    cb()\n  }\n\n  // if a %d placeholder is provided, add quantity\n  // to the arguments expanded by util.format.\n  var values = [str]\n  if (~str.indexOf('%d')) values.push(quantity)\n\n  return util.format.apply(util, values.concat(args))\n}\n\nY18N.prototype.setLocale = function (locale) {\n  this.locale = locale\n}\n\nY18N.prototype.getLocale = function () {\n  return this.locale\n}\n\nY18N.prototype.updateLocale = function (obj) {\n  if (!this.cache[this.locale]) this._readLocaleFile()\n\n  for (var key in obj) {\n    this.cache[this.locale][key] = obj[key]\n  }\n}\n\nmodule.exports = function (opts) {\n  var y18n = new Y18N(opts)\n\n  // bind all functions to y18n, so that\n  // they can be used in isolation.\n  for (var key in y18n) {\n    if (typeof y18n[key] === 'function') {\n      y18n[key] = y18n[key].bind(y18n)\n    }\n  }\n\n  return y18n\n}\n"]}