{"version":3,"sources":["validation.js"],"names":[],"mappings":"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","file":"validation-compiled.js","sourcesContent":["// validation-type-stuff, missing params,\n// bad implications, custom checks.\nmodule.exports = function (yargs, usage, y18n) {\n  var __ = y18n.__\n  var __n = y18n.__n\n  var self = {}\n\n  // validate appropriate # of non-option\n  // arguments were provided, i.e., '_'.\n  self.nonOptionCount = function (argv) {\n    var demanded = yargs.getDemanded()\n    var _s = argv._.length\n\n    if (demanded._ && (_s < demanded._.count || _s > demanded._.max)) {\n      if (demanded._.msg !== undefined) {\n        usage.fail(demanded._.msg)\n      } else if (_s < demanded._.count) {\n        usage.fail(\n          __('Not enough non-option arguments: got %s, need at least %s', argv._.length, demanded._.count)\n        )\n      } else {\n        usage.fail(\n          __('Too many non-option arguments: got %s, maximum of %s', argv._.length, demanded._.max)\n        )\n      }\n    }\n  }\n\n  // make sure that any args that require an\n  // value (--foo=bar), have a value.\n  self.missingArgumentValue = function (argv) {\n    var defaultValues = [true, false, '']\n    var options = yargs.getOptions()\n\n    if (options.requiresArg.length > 0) {\n      var missingRequiredArgs = []\n\n      options.requiresArg.forEach(function (key) {\n        var value = argv[key]\n\n        // if a value is explicitly requested,\n        // flag argument as missing if it does not\n        // look like foo=bar was entered.\n        if (~defaultValues.indexOf(value) ||\n          (Array.isArray(value) && !value.length)) {\n          missingRequiredArgs.push(key)\n        }\n      })\n\n      if (missingRequiredArgs.length > 0) {\n        usage.fail(__n(\n          'Missing argument value: %s',\n          'Missing argument values: %s',\n          missingRequiredArgs.length,\n          missingRequiredArgs.join(', ')\n        ))\n      }\n    }\n  }\n\n  // make sure all the required arguments are present.\n  self.requiredArguments = function (argv) {\n    var demanded = yargs.getDemanded()\n    var missing = null\n\n    Object.keys(demanded).forEach(function (key) {\n      if (!argv.hasOwnProperty(key)) {\n        missing = missing || {}\n        missing[key] = demanded[key]\n      }\n    })\n\n    if (missing) {\n      var customMsgs = []\n      Object.keys(missing).forEach(function (key) {\n        var msg = missing[key].msg\n        if (msg && customMsgs.indexOf(msg) < 0) {\n          customMsgs.push(msg)\n        }\n      })\n\n      var customMsg = customMsgs.length ? '\\n' + customMsgs.join('\\n') : ''\n\n      usage.fail(__n(\n        'Missing required argument: %s',\n        'Missing required arguments: %s',\n        Object.keys(missing).length,\n        Object.keys(missing).join(', ') + customMsg\n      ))\n    }\n  }\n\n  // check for unknown arguments (strict-mode).\n  self.unknownArguments = function (argv, aliases) {\n    var aliasLookup = {}\n    var descriptions = usage.getDescriptions()\n    var demanded = yargs.getDemanded()\n    var unknown = []\n\n    Object.keys(aliases).forEach(function (key) {\n      aliases[key].forEach(function (alias) {\n        aliasLookup[alias] = key\n      })\n    })\n\n    Object.keys(argv).forEach(function (key) {\n      if (key !== '$0' && key !== '_' &&\n        !descriptions.hasOwnProperty(key) &&\n        !demanded.hasOwnProperty(key) &&\n        !aliasLookup.hasOwnProperty(key)) {\n        unknown.push(key)\n      }\n    })\n\n    if (unknown.length > 0) {\n      usage.fail(__n(\n        'Unknown argument: %s',\n        'Unknown arguments: %s',\n        unknown.length,\n        unknown.join(', ')\n      ))\n    }\n  }\n\n  // validate arguments limited to enumerated choices\n  self.limitedChoices = function (argv) {\n    var options = yargs.getOptions()\n    var invalid = {}\n\n    if (!Object.keys(options.choices).length) return\n\n    Object.keys(argv).forEach(function (key) {\n      if (key !== '$0' && key !== '_' &&\n        options.choices.hasOwnProperty(key)) {\n        [].concat(argv[key]).forEach(function (value) {\n          // TODO case-insensitive configurability\n          if (options.choices[key].indexOf(value) === -1) {\n            invalid[key] = (invalid[key] || []).concat(value)\n          }\n        })\n      }\n    })\n\n    var invalidKeys = Object.keys(invalid)\n\n    if (!invalidKeys.length) return\n\n    var msg = __('Invalid values:')\n    invalidKeys.forEach(function (key) {\n      msg += '\\n  ' + __(\n        'Argument: %s, Given: %s, Choices: %s',\n        key,\n        usage.stringifiedValues(invalid[key]),\n        usage.stringifiedValues(options.choices[key])\n      )\n    })\n    usage.fail(msg)\n  }\n\n  // custom checks, added using the `check` option on yargs.\n  var checks = []\n  self.check = function (f) {\n    checks.push(f)\n  }\n\n  self.customChecks = function (argv, aliases) {\n    checks.forEach(function (f) {\n      try {\n        var result = f(argv, aliases)\n        if (!result) {\n          usage.fail(__('Argument check failed: %s', f.toString()))\n        } else if (typeof result === 'string') {\n          usage.fail(result)\n        }\n      } catch (err) {\n        usage.fail(err.message ? err.message : err)\n      }\n    })\n  }\n\n  // check implications, argument foo implies => argument bar.\n  var implied = {}\n  self.implies = function (key, value) {\n    if (typeof key === 'object') {\n      Object.keys(key).forEach(function (k) {\n        self.implies(k, key[k])\n      })\n    } else {\n      implied[key] = value\n    }\n  }\n  self.getImplied = function () {\n    return implied\n  }\n\n  self.implications = function (argv) {\n    var implyFail = []\n\n    Object.keys(implied).forEach(function (key) {\n      var num\n      var origKey = key\n      var value = implied[key]\n\n      // convert string '1' to number 1\n      num = Number(key)\n      key = isNaN(num) ? key : num\n\n      if (typeof key === 'number') {\n        // check length of argv._\n        key = argv._.length >= key\n      } else if (key.match(/^--no-.+/)) {\n        // check if key doesn't exist\n        key = key.match(/^--no-(.+)/)[1]\n        key = !argv[key]\n      } else {\n        // check if key exists\n        key = argv[key]\n      }\n\n      num = Number(value)\n      value = isNaN(num) ? value : num\n\n      if (typeof value === 'number') {\n        value = argv._.length >= value\n      } else if (value.match(/^--no-.+/)) {\n        value = value.match(/^--no-(.+)/)[1]\n        value = !argv[value]\n      } else {\n        value = argv[value]\n      }\n\n      if (key && !value) {\n        implyFail.push(origKey)\n      }\n    })\n\n    if (implyFail.length) {\n      var msg = __('Implications failed:') + '\\n'\n\n      implyFail.forEach(function (key) {\n        msg += ('  ' + key + ' -> ' + implied[key])\n      })\n\n      usage.fail(msg)\n    }\n  }\n\n  return self\n}\n"]}